<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>C2nxt A Proof-of-Concept For A Modern Standard Library for GNU C and C2x</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark+documentation.compiled.css" />
  <link rel="icon" href="favicon-dark.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">C2nxt <span class="m-thin">A Proof-of-Concept For A Modern Standard Library for GNU C and C2x</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="modules.html">Modules</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="2">
            <li><a href="annotated.html">Classes</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          C2nxt
        </h1>
<p><a name="md__home_braxton_git_C2nxt_README"></a> C2nxt is a GNU C23 library providing type-safe collections and ergonomic features typical in higher-level languages, to C. It aims to be a proof-of-concept view of what a more modern standard (or at least widely used base) library could look like in the future if it only had to support C23, with much more modern abstractions and ergonomics over the standard C library. It is currently under active development and has not yet hit a <strong>stable</strong> release point.</p><p>Some features of C2nxt include:</p><ul><li>Type-Safe collections implemented (mostly) as manually instantiated templates. Currently implemented collections include <code><a href="structStdString.html" class="m-doc">StdString</a></code>, <code><a href="group__std__vector.html#ga4079328f875ae061145d750c84c3b44c" class="m-doc">StdVector(T)</a></code>, and <code><a href="group__std__array.html#ga428c4e1c071e8827620a6c870168a404" class="m-doc">StdArray(T, N)</a></code></li><li>Error handling facilities similar to Rust and <code>boost::outcome</code> with equivalent semantics and similar API to Rust, via <code><a href="structStdError.html" class="m-doc">StdError</a></code> and <code><a href="group__std__result.html#ga0b1f67fd926286ef59a20af5c377a22a" class="m-doc">StdResult(T)</a></code></li><li>Optional value type, <code><a href="group__std__option.html#gadfddd8a6f93d2375b37f7cca25a8af25" class="m-doc">StdOption(T)</a></code> based on Rust&#x27;s <code>std::option::Option</code> with equivalent semantics and similar API to Rust</li><li>Facilities for defining, implementing, and using polymorphic interfaces via Traits</li><li>Iterators, Ranges, and <code>foreach</code> loops (equivalent to C++&#x27;s <code>for(elem : collection)</code>)</li><li>Human-readable (no more having to remember which character combination corresonds to which type in <code>printf</code>), type-safe string formatting and formatted I/O via the <code><a href="structStdFormat.html" class="m-doc">StdFormat</a></code> Trait</li></ul><section id="autotoc_md1"><h5><a href="#autotoc_md1">Why not standard C?</a></h5><p>C2nxt makes heavy use of <code>__auto_type</code> and some of its features are only possible with it. It also uses statement-expressions for several features and <code>__attribute__(cleanup)</code> for scoped destruction. It could be refactored to be Standard C in C23 or a subsequent standard, if C gets <code>auto</code>, <code>typeof</code>, <code>__VA_OPT__</code>, lamdas, and defer.</p></section><section id="autotoc_md2"><h5><a href="#autotoc_md2">Can I use this in production?</a></h5><p>Can you? Sure! Should you? Probably not yet. Testing right now is minimal and only enough to ensure a majority of functionality works in the general case, and is definitely not thorough enough yet to ensure reliability in production.</p></section><section id="autotoc_md3"><h2><a href="#autotoc_md3">Documentation</a></h2><p>You can view the documentation <a href="https://braxtons12.github.io/C2nxt/">here</a></p></section><section id="autotoc_md4"><h2><a href="#autotoc_md4">Getting Started</a></h2><p>C2nxt uses CMake, and incorporating it into your project is easy!</p><p>First, set up your CMake project. In <code>CMakeLists.txt</code>:</p><pre class="m-code"><span class="nb">FetchContent_Declare</span><span class="p">(</span><span class="s">C2nxt</span>
        <span class="s">GIT_REPOSITORY</span> <span class="s2">&quot;https://github.com/braxtons12/C2nxt&quot;</span>
        <span class="s">GIT_TAG</span> <span class="s2">&quot;0.1.0&quot;</span>
        <span class="p">)</span>

<span class="nb">FetchContent_MakeAvailable</span><span class="p">(</span><span class="s">C2nxt</span><span class="p">)</span>

<span class="c">### Setup your target......</span>

<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">your_target</span> <span class="s">C2nxt</span><span class="p">)</span></pre><p>Then, include your desired headers, either the main header, <code><a href="C2nxt_8h.html" class="m-doc">C2nxt/<wbr />C2nxt.h</a></code>, for everything, or individual ones for granular imports.</p><section id="autotoc_md5"><h3><a href="#autotoc_md5">Example</a></h3><pre class="m-code"><span class="cp">#include</span> <span class="cpf">&lt;C2nxt/StdDef.h&gt;</span><span class="cp"></span>
<span class="cp">#define VECTOR_INCLUDE_DEFAULT_INSTANTIATIONS TRUE</span>
<span class="cp">#define RANGE_INCLUDE_DEFAULT_INSTANTIATIONS TRUE</span>
<span class="cp">#include</span> <span class="cpf">&lt;C2nxt/C2nxt.h&gt;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">transform</span><span class="p">(</span><span class="n">i32</span><span class="o">*</span> <span class="kr">restrict</span> <span class="n">elem</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">*</span><span class="n">elem</span> <span class="o">*=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">i32</span> <span class="nf">main</span><span class="p">(</span><span class="n">i32</span> <span class="n">argc</span><span class="p">,</span> <span class="n">const_cstring</span><span class="o">*</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// vector is already instantiated for builtins like `i32` and some provided types like `StdString`,</span>
    <span class="c1">// so, we can just use it directly here</span>
    <span class="n">let_mut</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">std_vector_new_with_capacity</span><span class="p">(</span><span class="n">i32</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

    <span class="c1">// insert 10 elements, 0 through 9, into the vector</span>
    <span class="n">ranged_for</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std_vector_push_back</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// print information about the vector (size, capacity, whether it is currently in</span>
    <span class="c1">// small-size-optimization mode) to stdout, followed by a newline.</span>
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">as_format_t</span><span class="p">(</span><span class="n">StdVector</span><span class="p">(</span><span class="n">i32</span><span class="p">),</span> <span class="n">vec</span><span class="p">));</span>

    <span class="c1">// print each element, followed by a newline, to stdout</span>
    <span class="c1">// prints 0 through 9</span>
    <span class="n">foreach</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">);</span>    
    <span class="p">}</span>

    <span class="c1">// transform the elements in the vector with the above-defined `transform` function</span>
    <span class="c1">// and returns a view of the vector as a `StdRange(i32)` (that we ignore)</span>
    <span class="n">std_transform</span><span class="p">(</span><span class="n">i32</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">transform</span><span class="p">);</span>

    <span class="c1">// print each element, followed by a newline, to stdout</span>
    <span class="c1">// prints multiples of 3 from 0 through 27</span>
    <span class="n">foreach</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">elem</span><span class="p">);</span>    
    <span class="p">}</span>
<span class="p">}</span></pre></section><section id="autotoc_md6"><h3><a href="#autotoc_md6">Collections</a></h3><p>C2nxt collections provide type-safety, iterators, the ability to use user-provided default and copy constructors, and destructors, for stored types, and, where applicable, are allocator aware. For more details on collections, see the documentation on the specific collection.</p></section><section id="autotoc_md7"><h3><a href="#autotoc_md7">Formatting</a></h3><p>String formatting uses a very simple syntax. In a format string, <code>{}</code> specifies that an argument should be formatted and placed in that location. Format specifiers can be placed inside the braces to specify the way the argument should be formatted. Currently supported specifiers are limited:</p><ul><li><code>{}</code>: The default format</li><li><code>{d}</code>: Format the associated argument as a decimal (base-10) number. This is the default for integral types. Only applicable to signed, unsigned, and floating point numeric types</li><li><code>{dyy}</code>: Format a floating point number as a decimal (base-10) number, with <code>yy</code> digits after the decimal point</li><li><code>{e}</code>: Format a floating point number as scientific notation with the default number of significant figures (3) after the decimal point. This is the default for floating point types.</li><li><code>{eyy}</code>: Format a floating point number as scientific notation with <code>yy</code> number of significant figures after the decimal point.</li><li><code>{x}</code>: Format an integral number as lower-case hexadecimal</li><li><code>{X}</code>: Format an integral number as upper-case hexadecimal</li></ul><p>Providing a specifier that is invalid for the associated argument will result in a runtime assert in debug builds and unspecified behavior in release builds (for builtin and provided types).</p><p>For more details on string formatting, see the documentation for the <code><a href="structStdFormat.html" class="m-doc">StdFormat</a></code> Trait, <code><a href="group__format.html#ga9470755f912aae3ac2977adc596b4d61" class="m-doc">std_<wbr />format(format_<wbr />string, ...)</a></code>, and the <a href="group__format.html" class="m-doc">StdFormat</a> module.</p></section><section id="autotoc_md8"><h3><a href="#autotoc_md8">Performance</a></h3><p>I know, you&#x27;re probably thinking &quot;So, something that nice can&#x27;t be fast right? What&#x27;s the cost?&quot; And the answer is: not necessarily anything. Yes there is a performance hit to use all the functionality available, but it&#x27;s small compared to the increased ergonomics and composability gained from using the library&#x27;s features.</p><p>The implementation of <code>println</code> makes heavy use of most of the functionality presented in the example (except for <code><a href="group__ranges.html#ga0c3e413222c6c5072b1c6ac94b1e7fb6" class="m-doc">StdRange(T)</a></code>), as well as the <code>Result(T)</code> type, which means it&#x27;s using most of the facilities currently provided by the library. So, lets look at a benchmark comparing the relative speed of <code>println</code> to <code>printf</code>.</p><p>This benchmark consisted of printing out N strings to <code>stdout</code> consisting of:</p><ul><li>the Mth multiple of 1024, unsigned</li><li>the Mth multiple of negative 1024</li><li>the Mth multiple of negative 1024.1024</li><li>a <code><a href="structStdString.html" class="m-doc">StdString</a></code> pre-initialized to &quot;This is a string&quot;</li></ul><p>where M is in [0, N)</p><p>It was run 10 times for each N, with the average of the 10 runs taken. The benchmark was performed with builds from both Clang 12.0.1 and GCC 10.3.0, and with both the default system allocator and jemalloc.<br />All benchmarks were run on an Intel Core i7-8750H with 16GB RAM running Ubuntu 21.04.<br />Clang builds were compiled with &quot;-flto -Ofast -ffast-math -DNDEBUG&quot;.<br />GCC builds were compiled with &quot;-flto -Ofast -DNDEBUG&quot; All numbers are relative performance compared to <code>printf</code></p><table class="m-table"><thead><tr><th>N</th><th>Clang + System Allocator</th><th>Clang + jemalloc</th><th>GCC + System Allocator</th><th>GCC + jemalloc</th></tr></thead><tbody><tr><td>1</td><td>1.9247</td><td>1.6224</td><td>3.0393</td><td>1.4195</td></tr><tr><td>10</td><td>1.4561</td><td>1.0620</td><td>1.6721</td><td>2.0558</td></tr><tr><td>100</td><td>0.9669</td><td>0.9617</td><td>0.9007</td><td>0.8877</td></tr><tr><td>1000</td><td>1.0008</td><td>1.0048</td><td>0.9044</td><td>0.9094</td></tr><tr><td>10000</td><td>0.9971</td><td>1.0094</td><td>0.9009</td><td>0.8968</td></tr><tr><td>100000</td><td>1.0156</td><td>1.0133</td><td>0.9000</td><td>0.8972</td></tr><tr><td>average</td><td>1.2269</td><td>1.1231</td><td>1.3862</td><td>1.1777</td></tr></tbody></table><p>For the code used for the benchmark and more detailed results (Std. Dev., Median, individual runs), see the project/code in the &quot;benchmark&quot; subfolder.</p><p>So, on <strong>average</strong> (at least on linux, benchmark on your specific platform for platform specific numbers) you can expect around a 23% performance <strong>boost</strong> compared to <code>printf</code>, for infrequent I/O you can expect up to a 200% performance <strong>boost</strong>, and for high frequency I/O you can expect anywhere from a 1.5% performance <strong>boost</strong> to a 10% performance hit (on average, a 4.4% performance hit). If you dig into the benchmark results, you&#x27;ll see that in general you can expect it to be fairly allocator insensitive with clang (less so with GCC, particularly at small workloads), and that the clang + jemalloc pairing is the most <strong>consistently</strong> fast option to use.</p><p>This was the performance for formatting builtin types (u32, i32, f32, cstring), but it would be reasonable to expect this to translate to custom types as well (<code><a href="structStdString.html" class="m-doc">StdString</a></code>&#x27;s <code><a href="structStdFormat.html" class="m-doc">StdFormat</a></code> implementation simply forwards itself, so it&#x27;s nearly the same as passing a <code>const char*</code> to <code>printf</code> in terms of cost).</p><p>In our opinion, this is often a reasonable tradeoff for the greatly improved ergonomics and composability.</p></section><section id="autotoc_md9"><h3><a href="#autotoc_md9">Testing</a></h3><p>Tests are set up as a separate &quot;Test&quot; target in the CMake project.<br />To run the tests, simply configure and build the test target, then run the resulting &quot;Test&quot; executable.<br />Please feel free to submit new tests!</p><p>Inside the C2nxt main directory:</p><pre class="m-code">cmake -B build -G <span class="s2">&quot;Ninja&quot;</span>
cmake --build build --target Test
./build/Test</pre></section><section id="autotoc_md10"><h3><a href="#autotoc_md10">Contributing</a></h3><p>Feel free to submit issues, pull requests, etc.!<br />When contributing code, please adhead to the project <code>.clang-tidy</code>, follow the project <code>.clang-format</code> (except in judicious cases of macros ruining things), prefer <code>let</code> or <code>let_mut</code> over explicit typing (where possible), and prefer simplicity and correctness over performance by default.</p></section><section id="autotoc_md11"><h3><a href="#autotoc_md11">License</a></h3><p>C2nxt uses the MIT license.</p></section><section id="autotoc_md12"><h3><a href="#autotoc_md12">Special Thanks</a></h3><p>Special thanks should be given to the Rust team and C++ standardization committee, and contributors of each, for creating great programming languages that have inspired a lot of the functionality provided by this library. Thanks should also go to <a href="https://github.com/TotallyNotChase/">TotallyNotChase</a> for inspiring the design of the Trait system and Iterators with <a href="https://github.com/TotallyNotChase/c-iterators/">c-iterators</a> and to <a href="https://github.com/Hirrolot/">Hirrolot</a> for also inspiring the Trait system with <a href="https://github.com/Hirrolot/interface99">interface99</a>.</p></section></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v2.js"></script>
<script src="searchdata-v2.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>C2nxt A Proof-of-Concept For A Modern Standard Library for GNU C and C2x. Created with <a href="https://doxygen.org/">Doxygen</a> 1.9.1 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
